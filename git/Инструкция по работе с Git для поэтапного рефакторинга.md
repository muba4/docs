# Инструкция по работе с Git для поэтапного рефакторинга

Этот документ описывает пошаговый план работы с Git для выполнения этапов рефакторинга, таких как описаны в `1001.md` и последующих. Он позволяет изолировать изменения, тестировать их локально и при необходимости откатывать, не влияя на основную ветку разработки.

## Предварительные условия

- Ваша основная ветка называется `main`.
- У вас есть локальный репозиторий, синхронизированный с удалённым (например, GitHub).
- Вы будете выполнять кодовые изменения в отдельном окне/сессии с ИИ, а затем вносить их в Git.

## План действий

### Перед началом первого этапа (или после мержа предыдущего):

1. **(Локально)** Убедитесь, что вы находитесь в ветке `main` и она обновлена до последнего состояния с удалённого репозитория.
    ```bash
    git checkout main
    git pull origin main
    ```
    *Это гарантирует, что вы начинаете с актуального кода.*

### Для каждого этапа (например, "Этап 1: Создание/Обновление `MissionService`"):

1.  **(Локально)** Создайте новую ветку для конкретного этапа, дав ей осмысленное имя, отражающее суть изменений. Удобно включать номер или краткое название этапа в имя ветки.
    ```bash
    git checkout -b refactor-step1 main
    ```
    *Команда `checkout -b` создаст новую ветку и переключит вас на неё. Она будет создана на основе `main`.*

2.  **(В новом окне с ИИ)** Выполните инструкции ИИ по соответствующему этапу (например, `1001.md`), получив все необходимые файлы. После получения кода от ИИ:
    - Внесите изменения в соответствующие файлы в своей локальной копии проекта (в ветке `refactor-step1`).
    - Внесите изменения в файлы документации (например, `9. Архитектура контроллеров...`, `10. Архитектура сервисов...`).
    - Внесите обновления в файл реестра документации, если номера версий изменились (например, `0. Реестр...`).
    *Важно: делайте это в той же ветке, которую вы создали на шаге 1.*

3.  **(Локально)** После внесения всех изменений от ИИ, **локально протестируйте** функциональность, связанную с этим этапом, на своей машине разработки.
    - Убедитесь, что приложение запускается без ошибок.
    - Проверьте, что изменённая функциональность работает корректно (например, создание миссии, начисление бонусов, если они уже интегрированы).
    - Убедитесь, что не сломалась *другая* функциональность, которая может быть связана с затронутыми файлами.

4.  **(Локально)** Если **тестирование прошло успешно**:
    - Проверьте статус файлов в `git`.
        ```bash
        git status
        ```
        *Должен показать изменённые, новые или удалённые файлы, связанные с вашим этапом.*
    - Добавьте изменённые/новые файлы в индекс `git`.
        ```bash
        git add .
        # Или добавьте файлы по отдельности, если хотите быть более осторожным.
        ```
    - Сделайте коммит с осмысленным сообщением.
        ```bash
        git commit -m "Refactor: Step 1 - Create/Update MissionService, move creation logic out of controller"
        ```
    - *(Опционально, но рекомендуется)* Отправьте ветку на удалённый репозиторий.
        ```bash
        git push origin refactor-step1
        ```

5.  **(Локально)** Если **тестирование показало ошибки или что-то пошло не так**, и вы хотите **откатиться**:
    > **ВНИМАНИЕ:** Следующие команды **удалят все локальные изменения** в текущей ветке.
    - **Сбросьте** все изменения, внесённые в этой ветке, до состояния, в котором она была создана (т.е. до состояния `main` на момент создания ветки). Это **удалит** все локальные изменения в этой ветке.
        ```bash
        # Убедитесь, что вы в нужной ветке (например, refactor-step1)
        git reset --hard origin/main
        # Или, если ветка ещё не была отправлена на origin:
        # git reset --hard main
        ```
    - **Удалите** локальную ветку (если вы хотите начать этап заново).
        ```bash
        git checkout main # Переключитесь на main
        git branch -D refactor-step1 # Удалите проблемную ветку
        ```
    - *(Опционально)* Если ветка была отправлена на удалённый репозиторий, удалите и её:
        ```bash
        git push origin --delete refactor-step1
        ```
    - **Начните этап заново**, создав новую ветку (вернитесь к шагу 1 для этого этапа) или внесите исправления в текущей ветке и повторите тестирование.

6.  **(Локально)** Если **тестирование прошло успешно** и коммит сделан:
    - Переключитесь обратно на ветку `main`.
        ```bash
        git checkout main
        ```
    - Слей (мерж) изменения из своей рабочей ветки в `main`.
        ```bash
        git merge refactor-step1
        ```
        *Если возникнут конфликты, их нужно будет разрешить.*
    - Удалите локальную ветку, так как она уже слита.
        ```bash
        git branch -d refactor-step1
        ```
    - *(Опционально, но рекомендуется)* Отправьте обновлённую ветку `main` на удалённый репозиторий.
        ```bash
        git push origin main
        ```

### Повторение для следующих этапов:

Повторите шаги 1-6 для каждого последующего этапа (Этап 2, Этап 3 и т.д.), создавая *новые* ветки на основе *обновлённой* ветки `main`.
